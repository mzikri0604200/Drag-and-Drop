/*! @name @filmgardi/videojs-next-episode @version 1.0.2 @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js"),require("global/document"),require("global/window")):"function"==typeof define&&define.amd?define(["video.js","global/document","global/window"],t):(e=e||self).videojsNextEpisode=t(e.videojs,e.document,e.window)}(this,function(e,t,i){"use strict";function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,i=i&&i.hasOwnProperty("default")?i.default:i;var o="Next_Episode_Container",a=212,s=function(){function e(e,t){this.options=t,this.player=e,this.dialog=null,this.nextEpisodeText="nextEpisodeText",this.titlePrefixText="Next Episode",this.seasonText="Season",this.episodeText="Episode"}var n=e.prototype;return n.getImage=function(e){return e||"#"},n.renderHtml=function(e){var n=this,o=this.options,s=o.nextEpisodeText,r=o.titlePrefixText,l=o.seasonText,d=o.episodeText,p=o.url,c=e.title,u=e.duration,h=e.imdbRank,f=e.serialSeason,g=e.serialPart,v=e.poster,x=t.createElement("div");x.id="next-dialog",x.className="next-dialog-container",x.innerHTML='<a href="'+p+'" class="next-dialog-link"><div class="next-dialog-poster">\n    <img src="'+this.getImage(v)+'"/></div>\n    <div class="next-dialog-content">\n      <div class="next-base-title"><span>'+(s||this.nextEpisodeText)+'</span></div>\n      <div class="next-episode-title">\n        <div class="episode-title">'+(r||this.titlePrefixText)+" "+c+'</div>\n        <div class="episode-num">'+(l||this.seasonText)+" "+f+" \n        "+(d||this.episodeText)+" "+g+'</div>\n      </div>\n      <div class="next-episode-info">\n        '+(u?'<span class="next-info-duration">'+u+"</span>":"")+"\n        "+(h?'<span class="next-info-imdb">'+h+"</span>":"")+"\n      </div>\n    </div></a>";var m=t.createElement("div");m.className="next-dialog-action",m.title="نرو قسمت بعدی",m.innerHTML='\n    <svg height="100%" version="1.1" viewBox="0 0 72 72" width="80%">\n        <circle class="next-autoplay-circle" cx="36" cy="36" fill="#333" fill-opacity="0.4" r="31.5">\n        </circle>\n        <circle class="next-autoplay-ring" cx="-36"\n          cy="36" fill-opacity="0" r="33.5" stroke="#FFFFFF" stroke-dasharray="211" \n          stroke-dashoffset="'+a+'" stroke-width="4" transform="rotate(-90)">\n        </circle>\n        <g id="Group_1245" data-name="Group 1245" transform="translate(-50 -50)">\n        <g id="EXIT" transform="translate(50 50)">\n        <rect id="Rectangle_550" data-name="Rectangle 550" width="7.04" height="35.201" rx="3.52" transform="translate(46 22) rotate(45)" fill="#fff"></rect>\n        <rect id="Rectangle_551" data-name="Rectangle 551" width="7.04" height="35.201" rx="3.52" transform="translate(51 47) rotate(135)" fill="#fff"></rect></g></g></svg>\n        <p>نرو قسمت بعدی</p>',m.onclick=function(){return n.stopAutoplay()},x.appendChild(m);var y=setInterval(function(){var e=t.getElementsByClassName("next-autoplay-ring")[0];e&&(a-=2.5,e.setAttribute("stroke-dashoffset",a),a<=0&&(clearInterval(y),n.redirectToNextEpisode()))},100);return i.intervalIdList||(i.intervalIdList=[]),i.intervalIdList.push({name:"nextAutoplay",id:y}),x},n.redirectToNextEpisode=function(){var e=this.options.url;e&&(i.location.href=e)},n.stopAutoplay=function(){var e=this,t=this.player,n=this.options;a=212,i.intervalIdList.map(function(o,a){if(t.currentTime()>n.showDialogTime&&"nextEpisode"===o.name&&clearInterval(o.id),"nextAutoplay"===o.name)return clearInterval(o.id),i.intervalIdList.splice(a,1),void e.removeDialog()})},n.createDialog=function(){var e=this.player,i=this.options;if(i.nextEpisodeData&&(this.dialog=t.createElement("div"),this.dialog.id=o,this.dialog.className="next-episode-dialog",this.dialog.appendChild(this.renderHtml(i.nextEpisodeData)),e.id_)){var n=t.getElementById(e.id_);n&&n.appendChild(this.dialog)}},n.isShow=function(){return!!t.getElementById(o)},n.showDialog=function(){var e=t.getElementById(o);e&&(this.dialog=e,this.removeDialog()),this.createDialog()},n.removeDialog=function(){var e=this.player;if(e.id_){var i=t.getElementById(e.id_);if(i){var n=t.getElementById(o);n&&i.removeChild(n)}}},n.removeElement=function(e){var i=t.getElementById(e);i&&i.parentNode.removeChild(i)},e}();s.prototype.controlText_="NextEpisodeDialog";var r=e.getComponent("Button"),l=e.getComponent("Component"),d=function(e){function o(t,i){var n;return(n=e.call(this,t,i)||this).nextEpisodeDialog=new s(t,i),n}n(o,e);var a=o.prototype;return a.buildCSSClass=function(){return"vjs-next-episode-control "+e.prototype.buildCSSClass.call(this)},a.handleClick=function(e){if(i.innerWidth<=800){var n=t.getElementsByClassName("vjs-vote-card")[0];n&&-1===n.classList.value.indexOf("vjs-hidden")&&n.parentNode.removeChild(n)}this.nextEpisodeDialog.showDialog()},o}(r);d.prototype.controlText_="NextEpisode",d.prototype.name=function(){return"NextEpisodeButton"},l.registerComponent("NextEpisodeButton",d);e.dom;var p=function(){function t(e,t){this.player=e,this.options=t,this.nextEpisodeDialog=new s(e,t)}var n=t.prototype;return n.addButtonToControlBar=function(){var e=this.player,t=this.options,i=new d(e,t),n=e.controlBar.children().length-3;e.controlBar.addChild(i,{componentClass:"nextEpisodeButton"},this.options.placementIndex||n).addClass("vjs-next-episode-button")},n.init=function(){var t=this;try{var n=this.player,o=this.options;o.url?(this.addButtonToControlBar(),o.showDialogTime?n.one("timeupdate",function(){i.intervalIdList||(i.intervalIdList=[]);var e=setInterval(function(){n&&(n.paused()||n.currentTime()>o.showDialogTime&&(t.nextEpisodeDialog.isShow()||t.nextEpisodeDialog.showDialog()))},500);i.intervalIdList.push({name:"nextEpisode",id:e})}):e.log("The 'showDialogTime' is required.")):e.log("The next episode 'url' is required.")}catch(t){e.log(t.message||"error on next-episode plugin.")}},t}();p.prototype.name="NextEpisode";var c=e.getPlugin("plugin"),u={},h=function(t){function i(i,n){var o;return(o=t.call(this,i)||this).options=e.mergeOptions(u,n),o.player.ready(function(){o.player.addClass("vjs-next-episode"),new p(o.player,o.options).init(),console.log("Create Next-Episode")}),o}return n(i,t),i}(c);return h.defaultState={},h.VERSION="1.0.2",e.registerPlugin("nextEpisode",h),h});
